<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản lý giá bán - Admin Panel</title>
    <link rel="stylesheet" href="assets/css/admin-style.css">
    <link rel="stylesheet" href="../client/assets/css/font.css">
    <link rel="icon" type="image/png" href="../client/assets/images/Logo.png">
    <link rel="stylesheet" href="assets/css/font.css">
</head>
<body>
    <!-- Admin Header -->
    <header class="admin-header">
        <div class="container">
            <div class="admin-logo">
                <img src="../client/assets/images/Logo.png" alt="Logo">
                <span>Admin Panel</span>
            </div>
            <div class="admin-user-info">
                <div class="user-avatar">A</div>
                <span>Admin User</span>
                <button class="logout-btn" onclick="handleLogout()">
                    <i class="fas fa-sign-out-alt"></i>
                    Đăng xuất
                </button>
            </div>
        </div>
    </header>

    <!-- Admin Layout -->
    <div class="admin-layout">
        <!-- Sidebar -->
        <nav class="admin-sidebar">
            <!-- Logo -->
            <div class="sidebar-logo">
                <div class="logo-text">
                    <div class="logo-icon">
                        <i class="fas fa-chart-bar"></i>
                    </div>
                    <span>AdminPanel</span>
                </div>
            </div>
            
            <!-- Menu -->
            <ul class="sidebar-menu">
                <div class="menu-section-title">Menu</div>
                <li>
                    <a href="dashboard.html">
                        <i class="fas fa-tachometer-alt"></i>
                        Dashboard
                    </a>
                </li>
                <li>
                    <a href="user-management.html">
                        <i class="fas fa-users"></i>
                        Quản lý khách hàng
                    </a>
                </li>
                <li>
                    <a href="product-type-management.html">
                        <i class="fas fa-tags"></i>
                        Quản lý loại sản phẩm
                    </a>
                </li>
                <li>
                    <a href="product-management.html">
                        <i class="fas fa-box"></i>
                        Quản lý sản phẩm
                    </a>
                </li>
                <li>
                    <a href="import-management.html">
                        <i class="fas fa-warehouse"></i>
                        Quản lý nhập hàng
                    </a>
                </li>
                <li>
                    <a href="price-management.html" class="active">
                        <i class="fas fa-dollar-sign"></i>
                        Quản lý giá bán
                    </a>
                </li>
                <li>
                    <a href="order-management.html">
                        <i class="fas fa-shopping-cart"></i>
                        Quản lý đơn hàng
                    </a>
                </li>
                <li>
                    <a href="inventory-management.html">
                        <i class="fas fa-clipboard-list"></i>
                        Quản lý tồn kho
                    </a>
                </li>
                <li>
                    <a href="#" onclick="handleLogout(); return false;">
                        <i class="fas fa-sign-out-alt"></i>
                        Đăng xuất
                    </a>
                </li>
            </ul>
        </nav>

        <!-- Mobile Menu Toggle -->
        <button class="mobile-menu-toggle" onclick="toggleMobileMenu()">
            <i class="fas fa-bars"></i>
        </button>

        <!-- Main Content -->
        <main class="admin-main">
            <div class="admin-content">
                <!-- Page Header -->
                <div class="page-header">
                    <h1 class="page-title">Quản lý giá bán</h1>
                    <p class="page-subtitle">Thiết lập và quản lý giá bán, phần trăm lợi nhuận theo loại sản phẩm</p>
                </div>

                <!-- Tabs -->
                <div class="price-tabs">
                    <button class="tab-button active" onclick="switchTab('by-type')">
                        <i class="fas fa-tags"></i>
                        Theo loại sản phẩm
                    </button>
                    <button class="tab-button" onclick="switchTab('by-product')">
                        <i class="fas fa-box"></i>
                        Theo sản phẩm
                    </button>
                    <button class="tab-button" onclick="switchTab('price-list')">
                        <i class="fas fa-list"></i>
                        Danh sách giá
                    </button>
                </div>

                <!-- Tab Content: By Product Type -->
                <div id="by-type-tab" class="tab-content active">
                    <div class="search-filter-bar">
                        <div class="search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" placeholder="Tìm kiếm loại sản phẩm...">
                        </div>
                        <button class="btn btn-primary" data-modal="addProfitModal">
                            <i class="fas fa-plus"></i>
                            Thêm quy tắc lợi nhuận
                        </button>
                    </div>

                    <div class="admin-card">
                        <div class="card-header">
                            <h3 class="card-title">Quy tắc lợi nhuận theo loại sản phẩm</h3>
                        </div>
                        <div class="table-container">
                            <table class="admin-table">
                                <thead>
                                    <tr>
                                        <th>Loại sản phẩm</th>
                                        <th>Phần trăm lợi nhuận (%)</th>
                                        <th>Ngày cập nhật</th>
                                        <th>Thao tác</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Thuốc cảm cúm</td>
                                        <td>25%</td>
                                        <td>10/12/2024</td>
                                        <td>
                                            <button class="btn btn-sm btn-warning" onclick="editProfitRule('LSP001')">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button class="btn btn-sm btn-danger" onclick="deleteProfitRule('LSP001')">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Vitamin và thực phẩm chức năng</td>
                                        <td>30%</td>
                                        <td>08/12/2024</td>
                                        <td>
                                            <button class="btn btn-sm btn-warning" onclick="editProfitRule('LSP002')">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button class="btn btn-sm btn-danger" onclick="deleteProfitRule('LSP002')">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Thuốc giảm đau</td>
                                        <td>20%</td>
                                        <td>05/12/2024</td>
                                        <td>
                                            <button class="btn btn-sm btn-warning" onclick="editProfitRule('LSP003')">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button class="btn btn-sm btn-danger" onclick="deleteProfitRule('LSP003')">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Thuốc ho</td>
                                        <td>22%</td>
                                        <td>03/12/2024</td>
                                        <td>
                                            <button class="btn btn-sm btn-warning" onclick="editProfitRule('LSP004')">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button class="btn btn-sm btn-danger" onclick="deleteProfitRule('LSP004')">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Thuốc tiêu hóa</td>
                                        <td>18%</td>
                                        <td>01/12/2024</td>
                                        <td>
                                            <button class="btn btn-sm btn-warning" onclick="editProfitRule('LSP005')">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button class="btn btn-sm btn-danger" onclick="deleteProfitRule('LSP005')">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Tab Content: By Product -->
                <div id="by-product-tab" class="tab-content">
                    <div class="search-filter-bar">
                        <div class="search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" placeholder="Tìm kiếm sản phẩm...">
                        </div>
                        <select class="form-control filter-select">
                            <option value="all">Tất cả loại sản phẩm</option>
                            <option value="LSP001">Thuốc cảm cúm</option>
                            <option value="LSP002">Vitamin và thực phẩm chức năng</option>
                            <option value="LSP003">Thuốc giảm đau</option>
                            <option value="LSP004">Thuốc ho</option>
                            <option value="LSP005">Thuốc tiêu hóa</option>
                        </select>
                        <button class="btn btn-primary" onclick="bulkUpdatePrices()">
                            <i class="fas fa-sync"></i>
                            Cập nhật giá hàng loạt
                        </button>
                    </div>

                    <div class="admin-card">
                        <div class="card-header">
                            <h3 class="card-title">Quy tắc lợi nhuận theo sản phẩm</h3>
                        </div>
                        <div class="table-container">
                            <table class="admin-table">
                                <thead>
                                    <tr>
                                        <th>Sản phẩm</th>
                                        <th>Loại sản phẩm</th>
                                        <th>Giá nhập</th>
                                        <th>Phần trăm lợi nhuận</th>
                                        <th>Giá bán</th>
                                        <th>Thao tác</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Panadol Extra 500mg</td>
                                        <td>Thuốc giảm đau</td>
                                        <td>20,000 VNĐ</td>
                                        <td>25%</td>
                                        <td>25,000 VNĐ</td>
                                        <td>
                                            <button class="btn btn-sm btn-warning" onclick="editProductPrice('SP001')">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Thuốc điều trị COVID-19</td>
                                        <td>Thuốc cảm cúm</td>
                                        <td>120,000 VNĐ</td>
                                        <td>25%</td>
                                        <td>150,000 VNĐ</td>
                                        <td>
                                            <button class="btn btn-sm btn-warning" onclick="editProductPrice('SP002')">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Ginkgo Biloba 120mg</td>
                                        <td>Vitamin và thực phẩm chức năng</td>
                                        <td>150,000 VNĐ</td>
                                        <td>20%</td>
                                        <td>180,000 VNĐ</td>
                                        <td>
                                            <button class="btn btn-sm btn-warning" onclick="editProductPrice('SP003')">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Hevel 500mg</td>
                                        <td>Thuốc tiêu hóa</td>
                                        <td>30,000 VNĐ</td>
                                        <td>17%</td>
                                        <td>35,000 VNĐ</td>
                                        <td>
                                            <button class="btn btn-sm btn-warning" onclick="editProductPrice('SP004')">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Immucan 100ml</td>
                                        <td>Vitamin và thực phẩm chức năng</td>
                                        <td>100,000 VNĐ</td>
                                        <td>20%</td>
                                        <td>120,000 VNĐ</td>
                                        <td>
                                            <button class="btn btn-sm btn-warning" onclick="editProductPrice('SP005')">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Tab Content: Price List -->
                <div id="price-list-tab" class="tab-content">
                    <div class="search-filter-bar">
                        <div class="search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" placeholder="Tìm kiếm theo tên sản phẩm, mã sản phẩm...">
                        </div>
                        <select class="form-control filter-select">
                            <option value="all">Tất cả loại sản phẩm</option>
                            <option value="LSP001">Thuốc cảm cúm</option>
                            <option value="LSP002">Vitamin và thực phẩm chức năng</option>
                            <option value="LSP003">Thuốc giảm đau</option>
                            <option value="LSP004">Thuốc ho</option>
                            <option value="LSP005">Thuốc tiêu hóa</option>
                        </select>
                        <button class="btn btn-success" onclick="exportPriceList()">
                            <i class="fas fa-download"></i>
                            Xuất danh sách giá
                        </button>
                    </div>

                    <div class="admin-card">
                        <div class="card-header">
                            <h3 class="card-title">Danh sách giá sản phẩm</h3>
                            <span class="text-muted">Tổng: 450 sản phẩm</span>
                        </div>
                        <div class="table-container">
                            <table class="admin-table">
                                <thead>
                                    <tr>
                                        <th>Mã SP</th>
                                        <th>Tên sản phẩm</th>
                                        <th>Loại sản phẩm</th>
                                        <th>Giá nhập</th>
                                        <th>Phần trăm lợi nhuận</th>
                                        <th>Giá bán</th>
                                        <th>Lợi nhuận</th>
                                        <th>Cập nhật lần cuối</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>SP001</td>
                                        <td>Panadol Extra 500mg</td>
                                        <td>Thuốc giảm đau</td>
                                        <td>20,000 VNĐ</td>
                                        <td>25%</td>
                                        <td>25,000 VNĐ</td>
                                        <td>5,000 VNĐ</td>
                                        <td>10/12/2024</td>
                                    </tr>
                                    <tr>
                                        <td>SP002</td>
                                        <td>Thuốc điều trị COVID-19</td>
                                        <td>Thuốc cảm cúm</td>
                                        <td>120,000 VNĐ</td>
                                        <td>25%</td>
                                        <td>150,000 VNĐ</td>
                                        <td>30,000 VNĐ</td>
                                        <td>08/12/2024</td>
                                    </tr>
                                    <tr>
                                        <td>SP003</td>
                                        <td>Ginkgo Biloba 120mg</td>
                                        <td>Vitamin và thực phẩm chức năng</td>
                                        <td>150,000 VNĐ</td>
                                        <td>20%</td>
                                        <td>180,000 VNĐ</td>
                                        <td>30,000 VNĐ</td>
                                        <td>05/12/2024</td>
                                    </tr>
                                    <tr>
                                        <td>SP004</td>
                                        <td>Hevel 500mg</td>
                                        <td>Thuốc tiêu hóa</td>
                                        <td>30,000 VNĐ</td>
                                        <td>17%</td>
                                        <td>35,000 VNĐ</td>
                                        <td>5,000 VNĐ</td>
                                        <td>03/12/2024</td>
                                    </tr>
                                    <tr>
                                        <td>SP005</td>
                                        <td>Immucan 100ml</td>
                                        <td>Vitamin và thực phẩm chức năng</td>
                                        <td>100,000 VNĐ</td>
                                        <td>20%</td>
                                        <td>120,000 VNĐ</td>
                                        <td>20,000 VNĐ</td>
                                        <td>01/12/2024</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- Pagination -->
                        <div class="pagination"></div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Add Profit Rule Modal -->
    <div id="addProfitModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Thêm quy tắc lợi nhuận</h3>
                <button class="close">&times;</button>
            </div>
            <form id="addProfitForm">
                <div class="form-group">
                    <label for="productType" class="form-label">Loại sản phẩm *</label>
                    <select id="productType" name="productType" class="form-control" required>
                        <option value="">Chọn loại sản phẩm</option>
                        <option value="LSP001">Thuốc cảm cúm</option>
                        <option value="LSP002">Vitamin và thực phẩm chức năng</option>
                        <option value="LSP003">Thuốc giảm đau</option>
                        <option value="LSP004">Thuốc ho</option>
                        <option value="LSP005">Thuốc tiêu hóa</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="profitPercentage" class="form-label">Phần trăm lợi nhuận (%) *</label>
                    <input type="number" id="profitPercentage" name="profitPercentage" class="form-control" min="0" max="100" step="0.1" required>
                    <small class="form-text text-muted">Nhập phần trăm lợi nhuận (ví dụ: 25 cho 25%)</small>
                </div>
                <div class="form-group">
                    <label for="profitNote" class="form-label">Ghi chú</label>
                    <textarea id="profitNote" name="profitNote" class="form-control" rows="3" placeholder="Nhập ghi chú cho quy tắc lợi nhuận"></textarea>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal(document.getElementById('addProfitModal'))">
                        Hủy
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i>
                        Thêm quy tắc
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Product Price Modal -->
    <div id="editPriceModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Chỉnh sửa giá sản phẩm</h3>
                <button class="close">&times;</button>
            </div>
            <form id="editPriceForm">
                <input type="hidden" id="editProductId" name="productId">
                <div class="form-group">
                    <label for="editProductName" class="form-label">Tên sản phẩm</label>
                    <input type="text" id="editProductName" class="form-control" readonly>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="editCostPrice" class="form-label">Giá nhập (VNĐ) *</label>
                        <input type="number" id="editCostPrice" name="costPrice" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="editProfitPercent" class="form-label">Phần trăm lợi nhuận (%) *</label>
                        <input type="number" id="editProfitPercent" name="profitPercent" class="form-control" min="0" max="100" step="0.1" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="editSellingPrice" class="form-label">Giá bán (VNĐ)</label>
                    <input type="number" id="editSellingPrice" name="sellingPrice" class="form-control" readonly>
                    <small class="form-text text-muted">Giá bán sẽ được tính tự động dựa trên giá nhập và phần trăm lợi nhuận</small>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal(document.getElementById('editPriceModal'))">
                        Hủy
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i>
                        Cập nhật giá
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script src="assets/js/admin.js"></script>
    <script>
        // Price management specific functions
        function loadCurrentPageData() {
            // Load price data
            console.log('Loading price data for page:', currentPage);
        }
        
        // Tab switching
        function switchTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all tab buttons
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(tabName + '-tab').classList.add('active');
            
            // Add active class to clicked button
            event.target.classList.add('active');
        }
        
        // Edit profit rule
        function editProfitRule(typeId) {
            // Mock data - replace with actual API call
            const profitData = {
                'LSP001': { percentage: 25, note: 'Quy tắc lợi nhuận cho thuốc cảm cúm' }
            };
            
            const data = profitData[typeId];
            if (data) {
                document.getElementById('productType').value = typeId;
                document.getElementById('profitPercentage').value = data.percentage;
                document.getElementById('profitNote').value = data.note;
                openModal('addProfitModal');
            }
        }
        
        // Delete profit rule
        function deleteProfitRule(typeId) {
            if (confirm('Bạn có chắc chắn muốn xóa quy tắc lợi nhuận này?')) {
                showAlert('Đang xóa quy tắc lợi nhuận...', 'info');
                setTimeout(() => {
                    showAlert('Xóa quy tắc lợi nhuận thành công!', 'success');
                    loadCurrentPageData();
                }, 1000);
            }
        }
        
        // Edit product price
        function editProductPrice(productId) {
            // Mock data - replace with actual API call
            const productData = {
                'SP001': { 
                    name: 'Panadol Extra 500mg', 
                    costPrice: 20000, 
                    profitPercent: 25, 
                    sellingPrice: 25000 
                }
            };
            
            const product = productData[productId];
            if (product) {
                document.getElementById('editProductId').value = productId;
                document.getElementById('editProductName').value = product.name;
                document.getElementById('editCostPrice').value = product.costPrice;
                document.getElementById('editProfitPercent').value = product.profitPercent;
                document.getElementById('editSellingPrice').value = product.sellingPrice;
                openModal('editPriceModal');
            }
        }
        
        // Calculate selling price
        function calculateSellingPrice() {
            const costPrice = parseFloat(document.getElementById('editCostPrice').value) || 0;
            const profitPercent = parseFloat(document.getElementById('editProfitPercent').value) || 0;
            const sellingPrice = costPrice * (1 + profitPercent / 100);
            document.getElementById('editSellingPrice').value = Math.round(sellingPrice);
        }
        
        // Bulk update prices
        function bulkUpdatePrices() {
            if (confirm('Bạn có chắc chắn muốn cập nhật giá cho tất cả sản phẩm theo quy tắc lợi nhuận hiện tại?')) {
                showAlert('Đang cập nhật giá hàng loạt...', 'info');
                setTimeout(() => {
                    showAlert('Cập nhật giá hàng loạt thành công!', 'success');
                    loadCurrentPageData();
                }, 2000);
            }
        }
        
        // Export price list
        function exportPriceList() {
            showAlert('Đang xuất danh sách giá...', 'info');
            setTimeout(() => {
                showAlert('Xuất danh sách giá thành công!', 'success');
            }, 1000);
        }
        
        // Handle add profit form
        document.getElementById('addProfitForm').addEventListener('submit', function(e) {
            e.preventDefault();
            handleAdd('addProfitForm', '/api/profit-rules');
        });
        
        // Handle edit price form
        document.getElementById('editPriceForm').addEventListener('submit', function(e) {
            e.preventDefault();
            handleAdd('editPriceForm', '/api/product-prices');
        });
        
        // Add event listeners for price calculation
        document.getElementById('editCostPrice').addEventListener('input', calculateSellingPrice);
        document.getElementById('editProfitPercent').addEventListener('input', calculateSellingPrice);
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            setupPagination(450, 1, 10);
        });
    </script>
    
    <style>
        .price-tabs {
            display: flex;
            border-bottom: 2px solid #e9ecef;
            margin-bottom: 20px;
        }
        
        .tab-button {
            padding: 12px 24px;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: #666;
            border-bottom: 2px solid transparent;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .tab-button:hover {
            color: #072E75;
            background: #f8f9fa;
        }
        
        .tab-button.active {
            color: #072E75;
            border-bottom-color: #072E75;
            background: #f8f9fa;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .text-muted {
            color: #6c757d;
            font-size: 14px;
        }
        
        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #f1f3f4;
        }
        
        .form-text {
            font-size: 12px;
            color: #6c757d;
            margin-top: 5px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        @media (max-width: 768px) {
            .price-tabs {
                flex-direction: column;
            }
            
            .tab-button {
                justify-content: center;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</body>
</html>
